<!DOCTYPE html>
<html lang="de">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title id="page-title">##TITLE##</title>
  <link rel="icon" href="favicon.ico" />
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/@mdi/font/css/materialdesignicons.min.css" rel="stylesheet">

  <style>
    /* ===== Variables ===== */
    :root {
      /* Backgrounds */
      --bg-dark: rgb(15, 32, 39);
      --bg-mid: rgb(32, 58, 67);
      --bg-light: rgb(44, 83, 100);

      /* Surfaces */
      --surface-top: rgba(30, 30, 30, 0.8);
      --surface-bottom: rgba(50, 50, 50, 0.8);
      --surface-bright: rgba(50, 50, 50, 0.8);

      /* Text */
      --text-main: rgb(224, 224, 224);
      --text-light: #fff;
      --text-muted: rgb(187, 187, 187);
      --text-dim: rgb(136, 136, 136);
      --text-soft: rgb(221, 221, 221);

      /* Brand */
      --primary: rgb(142, 45, 226);
      --primary-dark: rgb(74, 0, 224);

      /* Buttons */
      --btn-bg: rgb(44, 44, 84);
      --btn-bg-hover: rgb(64, 64, 122);

      /* Status */
      --success: rgb(0, 200, 81);
      --error: rgb(255, 68, 68);

      /* Effects */
      --shadow-dark: rgba(0, 0, 0, 0.7);
      --shadow-light: rgba(90, 90, 90, 0.2);
      --shadow-primary: rgba(138, 43, 226, 0.7);
      --shadow-primary-soft: rgba(138, 43, 226, 0.6);
      --shadow-success: rgba(0, 200, 81, 0.7);
      --shadow-error: rgba(255, 68, 68, 0.7);
    }

    /* ===== Base ===== */
    html,
    body {
      margin: 0;
      padding: 0;
      min-height: 100%;
    }

    body {
      font-family: "Roboto", sans-serif;
      background: linear-gradient(135deg, var(--bg-dark), var(--bg-mid), var(--bg-light));
      color: var(--text-main);
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      text-shadow: 0 0 10px var(--shadow-primary);
    }

    .green {
      color: var(--success);
    }

    .red {
      color: var(--error);
    }

    main.quiz {
      background: linear-gradient(180deg, var(--surface-top), var(--surface-bottom));
      backdrop-filter: blur(8px);
      padding: 2rem;
      border-radius: 1rem;
      box-shadow: 0 8px 30px var(--shadow-dark);
      max-width: 600px;
      width: 100%;
      text-align: center;
      animation: fadeIn 0.5s ease;
    }

    h1.title {
      font-size: 3rem;
      margin-bottom: 2rem;
      color: var(--primary);
    }

    h2.question {
      font-size: 1.5rem;
      margin-bottom: 1rem;
      color: var(--text-light);
    }

    /* ===== Language selector ===== */
    .language-select {
      position: absolute;
      top: 1rem;
      right: 1rem;
    }

    .language-select select {
      padding: 0.3rem;
      border-radius: 0.4rem;
      background: var(--btn-bg);
      color: var(--text-main);
      border: none;
      cursor: pointer;
      font-size: 0.9rem;
      box-shadow: 0 0 6px var(--shadow-light);
      transition: background 0.2s ease, transform 0.2s ease;
    }

    .language-select select:hover,
    .language-select select:focus-visible {
      background: var(--btn-bg-hover);
      transform: scale(1.05);
      outline: none;
    }

    /* ===== Progress ===== */
    .progress {
      height: 10px;
      background: var(--surface-bright);
      border-radius: 5px;
      margin-bottom: 1rem;
      overflow: hidden;
    }

    .progress-bar {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, var(--primary), var(--primary-dark));
      transition: width 0.4s ease;
    }

    /* ===== Answers ===== */
    .answers {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
    }

    .answers button {
      flex: 1;
      min-width: 0;
      padding: 1rem;
      border: none;
      border-radius: 0.5rem;
      font-size: 1.2rem;
      font-weight: bold;
      cursor: pointer;
      background: var(--btn-bg);
      color: var(--text-main);
      transition: all 0.3s;
    }

    .answers button:hover:not(:disabled),
    .answers button:focus-visible:not(:disabled) {
      background: var(--btn-bg-hover);
      box-shadow: 0 0 8px var(--shadow-primary-soft);
      outline: none;
    }

    .answers button.correct {
      background: var(--success) !important;
      color: var(--text-light);
      box-shadow: 0 0 10px var(--shadow-success);
    }

    .answers button.wrong {
      background: var(--error) !important;
      color: var(--text-light);
      box-shadow: 0 0 10px var(--shadow-error);
    }

    .answers button.dice-btn {
      flex: 0 0 auto;
      aspect-ratio: 1 / 1;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* ===== Score & Controls ===== */
    .score {
      margin: 1.5rem 0;
      color: var(--text-muted);
    }

    .score span {
      margin: 0 0.5rem;
      font-size: 1.2rem;
      font-weight: bold;
    }

    .controls {
      margin-top: 2rem;
      display: none;
    }

    .controls button {
      padding: 0.75rem 1.5rem;
      border: none;
      border-radius: 0.5rem;
      font-size: 1.2rem;
      cursor: pointer;
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      color: var(--text-light);
      transition: transform 0.2s;
    }

    .controls button:hover,
    .controls button:focus-visible {
      transform: scale(1.05);
      outline: none;
    }

    /* ===== Explanation ===== */
    .explanation {
      display: none;
      margin-top: 1rem;
      padding: 1rem;
      font-style: italic;
      min-height: 2rem;
      color: var(--text-soft);
      background: var(--surface-bright);
      backdrop-filter: blur(8px);
      border: 1px solid var(--shadow-light);
      border-radius: 1rem;
      text-align: left;
    }

    /* ===== Floating next button ===== */
    .next-btn {
      position: fixed;
      bottom: 1rem;
      left: 50%;
      transform: translateX(-50%) translateY(10px);
      padding: 0.75rem 1.25rem;
      border: none;
      border-radius: 0.5rem;
      font-size: 1.5rem;
      cursor: pointer;
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      color: var(--text-light);
      box-shadow: 0 8px 24px var(--shadow-primary-soft);
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s ease, transform 0.2s ease;
      z-index: 100;
    }

    .next-btn.show {
      opacity: 1;
      pointer-events: auto;
      transform: translateX(-50%) translateY(0);
    }

    /* ===== Credits ===== */
    footer.credits {
      margin-top: 2rem;
      font-size: 0.9rem;
      color: var(--text-dim);
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 1rem;
    }

    .credits a {
      color: var(--primary);
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      transition: transform 0.2s ease, color 0.2s ease;
    }

    .credits a:hover,
    .credits a:focus-visible {
      transform: scale(1.1);
      color: var(--text-light);
      outline: none;
    }

    /* ===== Animations ===== */
    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
  </style>
</head>

<body>
  <main class="quiz" role="main">
    <div class="language-select">
      <select id="language">
        <option value="de" selected>ðŸ‡©ðŸ‡ª</option>
        <option value="en">ðŸ‡¬ðŸ‡§</option>
      </select>
    </div>

    <h1 class="title" id="title"></h1>
    <h2 class="question" id="question">â€¦</h2>

    <div class="progress">
      <div class="progress-bar" id="progressBar"></div>
    </div>

    <div class="score" id="score"></div>
    <div class="answers" id="answers"></div>
    <div class="explanation" id="explanation"></div>

    <div class="controls" id="controls">
      <button id="restartBtn">
        <i class="fa-solid fa-rotate"></i>
      </button>
    </div>

    <footer class="credits" id="credits">
      ##CREDITS##: <a href="https://zionism.wtf/#zionist-or-nazi">zionism.wtf</a>
      <a href="https://github.com/dci-marc/zionism-wtf-de" aria-label="GitHub">
        <i class="mdi mdi-github"></i>
      </a>
      <a href="https://www.marxists.org/" aria-label="Marxists">
        <i class="mdi mdi-star"></i>
      </a>
      <a class="symbol" href="https://world.internationalism.org/" aria-label="Internationalism">
        <i class="mdi mdi-hammer-sickle"></i>
      </a>
    </footer>
  </main>

  <button id="nextBtn" class="next-btn" aria-hidden="true">â–¶</button>

  <script>
    "use strict";

    // ===== State =====
    let quizData = [];
    let currentIndex = 0;
    let correctCount = 0;
    let incorrectCount = 0;
    let currentLang = "de";

    // ===== Cached DOM =====
    const pageTitleEl = document.getElementById("page-title");
    const titleEl = document.getElementById("title");
    const creditsEl = document.getElementById("credits");
    const questionEl = document.getElementById("question");
    const answersEl = document.getElementById("answers");
    const explanationEl = document.getElementById("explanation");
    const controlsEl = document.getElementById("controls");
    const nextBtn = document.getElementById("nextBtn");
    const restartBtn = document.getElementById("restartBtn");
    const progressBar = document.getElementById("progressBar");
    const scoreEl = document.getElementById("score");
    const languageSelect = document.getElementById("language");

    // ===== Utils =====
    const shuffleArray = arr => {
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
    };

    const showNextBtn = () => {
      nextBtn.classList.add("show");
      nextBtn.setAttribute("aria-hidden", "false");
    };

    const hideNextBtn = () => {
      nextBtn.classList.remove("show");
      nextBtn.setAttribute("aria-hidden", "true");
    };

    const updateProgress = () => {
      const percent = (currentIndex / quizData.length) * 100;
      progressBar.style.width = `${percent}%`;
    };

    const updateScore = () => {
      scoreEl.innerHTML = `
        <span class="green"><i class="fa-solid fa-square-check"></i> ${correctCount}</span>
        <span class="red"><i class="fa-solid fa-square-xmark"></i> ${incorrectCount}</span>
      `;
    };

    // ===== Data loading =====
    async function loadQuizData(lang = "de") {
      try {
        const res = await fetch(`questions/questions_${lang}.json`);
        quizData = await res.json();
        shuffleArray(quizData);

        currentIndex = 0;
        correctCount = 0;
        incorrectCount = 0;
        restartBtn.style.display = "none";

        loadQuestion();
      } catch (err) {
        console.error("Failed to load quiz data:", err);
      }
    }

    async function loadDescriptions(lang = "de") {
      try {
        const res = await fetch(`descriptions/descriptions_${lang}.json`);
        const desc = await res.json();
        pageTitleEl.textContent = desc.title;
        titleEl.textContent = desc.title;
        creditsEl.innerHTML = creditsEl.innerHTML.replace("##CREDITS##", desc.credits);
      } catch (err) {
        console.error("Failed to load descriptions:", err);
      }
    }

    // ===== Quiz logic =====
    function loadQuestion() {
      if (!quizData.length) return;

      hideNextBtn();
      updateProgress();
      updateScore();

      const q = quizData[currentIndex];
      questionEl.innerHTML = q.question;
      answersEl.innerHTML = "";
      explanationEl.style.display = "none";
      controlsEl.style.display = "none";

      q.answers.forEach((answer, i) => {
        const btn = document.createElement("button");
        btn.textContent = answer;
        btn.addEventListener("click", () => selectAnswer(btn, i));
        answersEl.appendChild(btn);
      });

      // Dice button
      const diceBtn = document.createElement("button");
      diceBtn.innerHTML = '<i class="fa-solid fa-dice"></i>';
      diceBtn.classList.add("dice-btn");
      diceBtn.addEventListener("click", () => {
        const buttons = answersEl.querySelectorAll("button:not(.dice-btn)");
        if (!buttons.length) return;
        const randomIndex = Math.floor(Math.random() * buttons.length);
        buttons[randomIndex].click();
      });
      answersEl.insertBefore(diceBtn, answersEl.children[1]);

      titleEl.scrollIntoView({ behavior: "smooth", block: "start" });
    }

    function selectAnswer(button, index) {
      const q = quizData[currentIndex];
      const answerButtons = answersEl.querySelectorAll("button:not(.dice-btn)");
      const allButtons = answersEl.querySelectorAll("button");

      allButtons.forEach(b => b.disabled = true);

      if (index === q.correct) {
        button.classList.add("correct");
        correctCount++;
      } else {
        button.classList.add("wrong");
        answerButtons[q.correct]?.classList.add("correct");
        incorrectCount++;
      }

      updateScore();
      explanationEl.innerHTML = q.explanation;
      explanationEl.style.display = "block";
      controlsEl.style.display = "block";
      explanationEl.scrollIntoView({ behavior: "smooth", block: "start" });

      if (currentIndex < quizData.length - 1) {
        showNextBtn();
      } else {
        restartBtn.style.display = "inline-block";
      }
    }

    // ===== Event bindings =====
    nextBtn.addEventListener("click", () => {
      currentIndex++;
      loadQuestion();
    });

    restartBtn.addEventListener("click", () => {
      currentIndex = 0;
      correctCount = 0;
      incorrectCount = 0;
      restartBtn.style.display = "none";
      loadQuestion();
    });

    languageSelect.addEventListener("change", e => {
      currentLang = e.target.value;
      loadDescriptions(currentLang);
      loadQuizData(currentLang);
    });

    // ===== Init =====
    loadDescriptions(currentLang);
    loadQuizData(currentLang);
  </script>
</body>

</html>